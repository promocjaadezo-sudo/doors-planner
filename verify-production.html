<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weryfikacja Produkcyjna - Centralny Magazyn Stanu</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 900px;
      width: 100%;
      padding: 40px;
    }
    h1 {
      color: #1a202c;
      margin-bottom: 10px;
      font-size: 32px;
    }
    .subtitle {
      color: #718096;
      margin-bottom: 30px;
      font-size: 16px;
    }
    .test-section {
      background: #f7fafc;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid #667eea;
    }
    .test-title {
      font-weight: 700;
      font-size: 18px;
      color: #2d3748;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .test-result {
      font-family: 'Monaco', 'Courier New', monospace;
      background: #2d3748;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 14px;
      line-height: 1.6;
      overflow-x: auto;
    }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
    }
    .status.success {
      background: #c6f6d5;
      color: #22543d;
    }
    .status.error {
      background: #fed7d7;
      color: #742a2a;
    }
    .status.pending {
      background: #feebc8;
      color: #7c2d12;
    }
    .btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-right: 10px;
    }
    .btn:hover {
      background: #5a67d8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .btn.secondary {
      background: #48bb78;
    }
    .btn.secondary:hover {
      background: #38a169;
    }
    .summary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 24px;
      border-radius: 12px;
      margin-top: 30px;
      text-align: center;
    }
    .summary h2 {
      margin-bottom: 10px;
      font-size: 24px;
    }
    .summary .stats {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }
    .stat {
      flex: 1;
      min-width: 120px;
    }
    .stat-value {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 5px;
    }
    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }
    .icon {
      font-size: 24px;
    }
    .log {
      max-height: 300px;
      overflow-y: auto;
    }
    .log-entry {
      padding: 8px 0;
      border-bottom: 1px solid #4a5568;
    }
    .log-entry:last-child {
      border-bottom: none;
    }
    .timestamp {
      color: #a0aec0;
      font-size: 12px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .loading {
      display: inline-block;
      animation: spin 1s linear infinite;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ Weryfikacja Produkcyjna</h1>
    <p class="subtitle">Centralny Magazyn Stanu - Production Environment Check</p>

    <!-- Test 1: Åadowanie ModuÅ‚u -->
    <div class="test-section">
      <div class="test-title">
        <span class="icon">ğŸ“¦</span>
        Test 1: Åadowanie ModuÅ‚u
        <span id="status1" class="status pending">â³ Pending</span>
      </div>
      <p>Weryfikacja czy moduÅ‚ CentralnyMagazynStanu zostaÅ‚ poprawnie zaÅ‚adowany.</p>
      <div id="result1" class="test-result">Oczekiwanie na uruchomienie...</div>
    </div>

    <!-- Test 2: Singleton Pattern -->
    <div class="test-section">
      <div class="test-title">
        <span class="icon">ğŸ”—</span>
        Test 2: Singleton Pattern
        <span id="status2" class="status pending">â³ Pending</span>
      </div>
      <p>Sprawdzenie czy getInstance() zwraca tÄ™ samÄ… instancjÄ™.</p>
      <div id="result2" class="test-result">Oczekiwanie na uruchomienie...</div>
    </div>

    <!-- Test 3: Dodawanie do Historii -->
    <div class="test-section">
      <div class="test-title">
        <span class="icon">ğŸ“</span>
        Test 3: Dodawanie do Historii
        <span id="status3" class="status pending">â³ Pending</span>
      </div>
      <p>Test funkcji dodajDoHistorii() z danymi produkcyjnymi.</p>
      <div id="result3" class="test-result">Oczekiwanie na uruchomienie...</div>
    </div>

    <!-- Test 4: Export/Import JSON -->
    <div class="test-section">
      <div class="test-title">
        <span class="icon">ğŸ’¾</span>
        Test 4: Export/Import JSON
        <span id="status4" class="status pending">â³ Pending</span>
      </div>
      <p>Weryfikacja eksportu i importu stanu do/z JSON.</p>
      <div id="result4" class="test-result">Oczekiwanie na uruchomienie...</div>
    </div>

    <!-- Test 5: Performance -->
    <div class="test-section">
      <div class="test-title">
        <span class="icon">âš¡</span>
        Test 5: Performance
        <span id="status5" class="status pending">â³ Pending</span>
      </div>
      <p>Pomiar czasu wykonania operacji (target: <20ms).</p>
      <div id="result5" class="test-result">Oczekiwanie na uruchomienie...</div>
    </div>

    <!-- Test 6: Memory Management -->
    <div class="test-section">
      <div class="test-title">
        <span class="icon">ğŸ§ </span>
        Test 6: Memory Management (Limit 1000)
        <span id="status6" class="status pending">â³ Pending</span>
      </div>
      <p>Test limitu historii i zarzÄ…dzania pamiÄ™ciÄ….</p>
      <div id="result6" class="test-result">Oczekiwanie na uruchomienie...</div>
    </div>

    <!-- Przyciski -->
    <div style="margin: 30px 0;">
      <button class="btn" onclick="runAllTests()">ğŸ§ª Uruchom Wszystkie Testy</button>
      <button class="btn secondary" onclick="resetTests()">ğŸ”„ Reset</button>
    </div>

    <!-- Podsumowanie -->
    <div id="summary" class="summary" style="display: none;">
      <h2>ğŸ“Š Podsumowanie Weryfikacji</h2>
      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="passed-count">0</div>
          <div class="stat-label">âœ… Zaliczone</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="failed-count">0</div>
          <div class="stat-label">âŒ Niezaliczone</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="total-time">0ms</div>
          <div class="stat-label">â±ï¸ Czas caÅ‚kowity</div>
        </div>
      </div>
      <h3 style="margin-top: 20px;" id="final-status">Status: Pending</h3>
    </div>

    <!-- Console Log -->
    <div style="margin-top: 30px;">
      <h3 style="color: #2d3748; margin-bottom: 10px;">ğŸ“‹ Console Log</h3>
      <div class="test-result log" id="console-log" style="max-height: 200px;">
        <div class="log-entry">
          <span class="timestamp">[System]</span> Oczekiwanie na uruchomienie testÃ³w...
        </div>
      </div>
    </div>
  </div>

  <!-- Åadowanie moduÅ‚u -->
  <script src="state/CentralnyMagazynStanu.js"></script>

  <script>
    let totalTime = 0;
    let passed = 0;
    let failed = 0;

    function addLog(message) {
      const log = document.getElementById('console-log');
      const timestamp = new Date().toLocaleTimeString('pl-PL');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }

    function setStatus(testNum, status, message) {
      const statusEl = document.getElementById(`status${testNum}`);
      const resultEl = document.getElementById(`result${testNum}`);
      
      statusEl.className = `status ${status}`;
      statusEl.textContent = status === 'success' ? 'âœ… PASSED' : status === 'error' ? 'âŒ FAILED' : 'â³ Running';
      resultEl.textContent = message;

      if (status === 'success') passed++;
      if (status === 'error') failed++;
    }

    async function runAllTests() {
      addLog('ğŸš€ Rozpoczynam weryfikacjÄ™ produkcyjnÄ…...');
      const startTime = performance.now();
      
      // Reset counters
      passed = 0;
      failed = 0;
      totalTime = 0;

      // Test 1: Åadowanie moduÅ‚u
      try {
        addLog('ğŸ“¦ Test 1: Sprawdzam Å‚adowanie moduÅ‚u...');
        if (typeof CentralnyMagazynStanu === 'undefined') {
          throw new Error('CentralnyMagazynStanu nie jest zdefiniowany!');
        }
        setStatus(1, 'success', `âœ… SUCCESS\n\nModuÅ‚ CentralnyMagazynStanu zostaÅ‚ poprawnie zaÅ‚adowany.\nTyp: ${typeof CentralnyMagazynStanu}\nMetody: ${Object.getOwnPropertyNames(CentralnyMagazynStanu).join(', ')}`);
        addLog('âœ… Test 1 PASSED - ModuÅ‚ zaÅ‚adowany');
      } catch (e) {
        setStatus(1, 'error', `âŒ ERROR: ${e.message}`);
        addLog(`âŒ Test 1 FAILED - ${e.message}`);
      }

      await new Promise(r => setTimeout(r, 500));

      // Test 2: Singleton
      try {
        addLog('ğŸ”— Test 2: Sprawdzam Singleton pattern...');
        const m1 = CentralnyMagazynStanu.getInstance();
        const m2 = CentralnyMagazynStanu.getInstance();
        
        if (m1 === null || m2 === null) {
          throw new Error('getInstance() zwrÃ³ciÅ‚o null!');
        }
        
        if (m1 !== m2) {
          throw new Error('Singleton pattern nie dziaÅ‚a - rÃ³Å¼ne instancje!');
        }
        
        setStatus(2, 'success', `âœ… SUCCESS\n\nSingleton dziaÅ‚a poprawnie.\nInstancja 1 === Instancja 2: ${m1 === m2}\nTyp instancji: ${typeof m1}`);
        addLog('âœ… Test 2 PASSED - Singleton OK');
      } catch (e) {
        setStatus(2, 'error', `âŒ ERROR: ${e.message}`);
        addLog(`âŒ Test 2 FAILED - ${e.message}`);
      }

      await new Promise(r => setTimeout(r, 500));

      // Test 3: Dodawanie do historii
      try {
        addLog('ğŸ“ Test 3: TestujÄ™ dodawanie do historii...');
        const magazyn = CentralnyMagazynStanu.getInstance();
        const beforeCount = magazyn.pobierzStan().historiaCzatu.length;
        
        magazyn.dodajDoHistorii('Test produkcyjny', {
          env: 'production',
          timestamp: new Date().toISOString(),
          testId: Math.random().toString(36).substr(2, 9)
        });
        
        const afterCount = magazyn.pobierzStan().historiaCzatu.length;
        const lastEntry = magazyn.pobierzStan().historiaCzatu[afterCount - 1];
        
        if (afterCount <= beforeCount) {
          throw new Error('Wpis nie zostaÅ‚ dodany do historii!');
        }
        
        setStatus(3, 'success', `âœ… SUCCESS\n\nWpis dodany pomyÅ›lnie.\nPrzed: ${beforeCount} wpisÃ³w\nPo: ${afterCount} wpisÃ³w\nOstatni wpis: ${JSON.stringify(lastEntry, null, 2)}`);
        addLog(`âœ… Test 3 PASSED - Dodano wpis (${beforeCount} â†’ ${afterCount})`);
      } catch (e) {
        setStatus(3, 'error', `âŒ ERROR: ${e.message}`);
        addLog(`âŒ Test 3 FAILED - ${e.message}`);
      }

      await new Promise(r => setTimeout(r, 500));

      // Test 4: Export/Import
      try {
        addLog('ğŸ’¾ Test 4: TestujÄ™ export/import JSON...');
        const magazyn = CentralnyMagazynStanu.getInstance();
        
        // Dodaj unikalny wpis
        const uniqueId = Math.random().toString(36).substr(2, 9);
        magazyn.dodajDoHistorii('Test export/import', { uniqueId });
        
        // Export
        const exported = magazyn.exportujDoJSON();
        const exportSize = new Blob([exported]).size;
        
        // Reset
        const beforeReset = magazyn.pobierzStan().historiaCzatu.length;
        magazyn.resetujStan();
        const afterReset = magazyn.pobierzStan().historiaCzatu.length;
        
        // Import
        magazyn.importujZJSON(exported);
        const afterImport = magazyn.pobierzStan().historiaCzatu.length;
        
        // SprawdÅº czy unique wpis jest obecny
        const found = magazyn.pobierzStan().historiaCzatu.some(
          entry => entry.dane && entry.dane.uniqueId === uniqueId
        );
        
        if (!found) {
          throw new Error('Stan nie zostaÅ‚ poprawnie przywrÃ³cony!');
        }
        
        setStatus(4, 'success', `âœ… SUCCESS\n\nExport/Import dziaÅ‚a poprawnie.\nRozmiar JSON: ${exportSize} bytes\nPrzed reset: ${beforeReset} wpisÃ³w\nPo reset: ${afterReset} wpisÃ³w\nPo import: ${afterImport} wpisÃ³w\nUnique wpis odnaleziony: ${found}`);
        addLog(`âœ… Test 4 PASSED - Export/Import OK (${exportSize} bytes)`);
      } catch (e) {
        setStatus(4, 'error', `âŒ ERROR: ${e.message}\n\nStack: ${e.stack}`);
        addLog(`âŒ Test 4 FAILED - ${e.message}`);
      }

      await new Promise(r => setTimeout(r, 500));

      // Test 5: Performance
      try {
        addLog('âš¡ Test 5: MierzÄ™ wydajnoÅ›Ä‡...');
        const magazyn = CentralnyMagazynStanu.getInstance();
        
        const perfStart = performance.now();
        magazyn.dodajDoHistorii('Performance test', { data: 'x'.repeat(100) });
        const perfEnd = performance.now();
        const addTime = perfEnd - perfStart;
        
        const getStart = performance.now();
        magazyn.pobierzStan();
        const getEnd = performance.now();
        const getTime = getEnd - getStart;
        
        const exportStart = performance.now();
        magazyn.exportujDoJSON();
        const exportEnd = performance.now();
        const exportTime = exportEnd - exportStart;
        
        if (addTime > 20 || getTime > 20 || exportTime > 50) {
          throw new Error(`WydajnoÅ›Ä‡ poniÅ¼ej oczekiwaÅ„! Add: ${addTime.toFixed(2)}ms, Get: ${getTime.toFixed(2)}ms, Export: ${exportTime.toFixed(2)}ms`);
        }
        
        setStatus(5, 'success', `âœ… SUCCESS\n\nWydajnoÅ›Ä‡ doskonaÅ‚a!\ndodajDoHistorii(): ${addTime.toFixed(2)}ms (target: <20ms)\npobierzStan(): ${getTime.toFixed(2)}ms (target: <20ms)\nexportujDoJSON(): ${exportTime.toFixed(2)}ms (target: <50ms)`);
        addLog(`âœ… Test 5 PASSED - Performance OK (add: ${addTime.toFixed(2)}ms)`);
      } catch (e) {
        setStatus(5, 'error', `âŒ ERROR: ${e.message}`);
        addLog(`âŒ Test 5 FAILED - ${e.message}`);
      }

      await new Promise(r => setTimeout(r, 500));

      // Test 6: Memory Management
      try {
        addLog('ğŸ§  Test 6: TestujÄ™ zarzÄ…dzanie pamiÄ™ciÄ… (moÅ¼e chwilÄ™ potrwaÄ‡)...');
        const magazyn = CentralnyMagazynStanu.getInstance();
        magazyn.resetujStan();
        
        const maxLimit = 1000;
        const testCount = 1050; // WiÄ™cej niÅ¼ limit
        
        addLog(`   DodajÄ™ ${testCount} wpisÃ³w (limit: ${maxLimit})...`);
        for (let i = 0; i < testCount; i++) {
          magazyn.dodajDoHistorii(`Test ${i}`, { index: i });
          if (i % 100 === 0 && i > 0) {
            addLog(`   Progress: ${i}/${testCount}...`);
          }
        }
        
        const finalCount = magazyn.pobierzStan().historiaCzatu.length;
        
        if (finalCount > maxLimit) {
          throw new Error(`Limit przekroczony! Obecna iloÅ›Ä‡: ${finalCount}, limit: ${maxLimit}`);
        }
        
        // SprawdÅº czy najstarsze zostaÅ‚y usuniÄ™te (LIFO)
        const firstEntry = magazyn.pobierzStan().historiaCzatu[0];
        const expectedFirstIndex = testCount - maxLimit; // 50
        
        setStatus(6, 'success', `âœ… SUCCESS\n\nZarzÄ…dzanie pamiÄ™ciÄ… dziaÅ‚a poprawnie!\nDodano: ${testCount} wpisÃ³w\nOczekiwana iloÅ›Ä‡: ${maxLimit}\nRzeczywista iloÅ›Ä‡: ${finalCount}\nNajstarszy wpis: Test ${firstEntry.dane.index} (oczekiwano: â‰¥${expectedFirstIndex})\nLimit respektowany: ${finalCount <= maxLimit}`);
        addLog(`âœ… Test 6 PASSED - Memory OK (${finalCount}/${maxLimit})`);
      } catch (e) {
        setStatus(6, 'error', `âŒ ERROR: ${e.message}`);
        addLog(`âŒ Test 6 FAILED - ${e.message}`);
      }

      // Podsumowanie
      const endTime = performance.now();
      totalTime = Math.round(endTime - startTime);
      
      document.getElementById('passed-count').textContent = passed;
      document.getElementById('failed-count').textContent = failed;
      document.getElementById('total-time').textContent = totalTime + 'ms';
      
      const summaryEl = document.getElementById('summary');
      summaryEl.style.display = 'block';
      
      const finalStatus = document.getElementById('final-status');
      if (failed === 0) {
        finalStatus.textContent = 'âœ… Status: ALL TESTS PASSED - PRODUCTION READY!';
        finalStatus.style.color = '#c6f6d5';
        addLog(`ğŸ‰ WSZYSTKIE TESTY ZALICZONE (${passed}/${passed + failed}) w ${totalTime}ms`);
      } else {
        finalStatus.textContent = `âš ï¸ Status: ${failed} test(s) failed`;
        finalStatus.style.color = '#fed7d7';
        addLog(`âš ï¸ NIEKTÃ“RE TESTY NIE POWIODÅY SIÄ˜ (${passed}/${passed + failed}) w ${totalTime}ms`);
      }
    }

    function resetTests() {
      addLog('ğŸ”„ Reset testÃ³w...');
      for (let i = 1; i <= 6; i++) {
        document.getElementById(`status${i}`).className = 'status pending';
        document.getElementById(`status${i}`).textContent = 'â³ Pending';
        document.getElementById(`result${i}`).textContent = 'Oczekiwanie na uruchomienie...';
      }
      document.getElementById('summary').style.display = 'none';
      passed = 0;
      failed = 0;
      totalTime = 0;
      addLog('âœ… Reset zakoÅ„czony. Gotowe do ponownego uruchomienia.');
    }

    // Auto-start po zaÅ‚adowaniu
    window.addEventListener('load', () => {
      addLog('âœ… Strona zaÅ‚adowana. Gotowe do testÃ³w.');
      addLog('ğŸ’¡ Kliknij "Uruchom Wszystkie Testy" aby rozpoczÄ…Ä‡ weryfikacjÄ™.');
    });
  </script>
</body>
</html>
