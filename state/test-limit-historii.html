<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Limitu Historii - Centralny Magazyn Stanu</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(30, 41, 59, 0.8);
      border: 1px solid rgba(51, 65, 85, 0.6);
      border-radius: 16px;
      padding: 40px;
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }
    h1 {
      font-size: 32px;
      margin-bottom: 24px;
      background: linear-gradient(135deg, #3b82f6, #06b6d4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .info-box {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid #3b82f6;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }
    .info-box strong {
      color: #3b82f6;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: rgba(15, 23, 42, 0.8);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }
    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #3b82f6;
      margin-bottom: 8px;
    }
    .stat-label {
      font-size: 12px;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .progress-bar {
      width: 100%;
      height: 24px;
      background: rgba(15, 23, 42, 0.8);
      border-radius: 12px;
      overflow: hidden;
      margin: 16px 0;
      position: relative;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #3b82f6);
      transition: width 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
    }
    .progress-fill.warning {
      background: linear-gradient(90deg, #eab308, #f97316);
    }
    .progress-fill.danger {
      background: linear-gradient(90deg, #f97316, #ef4444);
    }
    .controls {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      font-size: 14px;
    }
    button:hover {
      background: #2563eb;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
    }
    button.success {
      background: #10b981;
    }
    button.success:hover {
      background: #059669;
    }
    button.warning {
      background: #eab308;
      color: #000;
    }
    button.warning:hover {
      background: #ca8a04;
    }
    button.danger {
      background: #ef4444;
    }
    button.danger:hover {
      background: #dc2626;
    }
    .log {
      background: rgba(15, 23, 42, 0.8);
      border-radius: 8px;
      padding: 20px;
      margin-top: 24px;
      font-family: 'Consolas', monospace;
      font-size: 13px;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid rgba(51, 65, 85, 0.6);
    }
    .log-entry {
      padding: 4px 0;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }
    .log-entry:last-child {
      border-bottom: none;
    }
    .log-entry.success { color: #10b981; }
    .log-entry.warning { color: #eab308; }
    .log-entry.error { color: #ef4444; }
    .log-entry.info { color: #06b6d4; }
    
    input[type="number"] {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 6px;
      padding: 12px;
      color: #e2e8f0;
      font-size: 14px;
      width: 120px;
    }
    
    .test-results {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid #10b981;
      border-radius: 8px;
      padding: 20px;
      margin-top: 24px;
      display: none;
    }
    .test-results.show {
      display: block;
    }
    .test-results h3 {
      color: #10b981;
      margin-bottom: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª Test Limitu Historii</h1>
    
    <div class="info-box">
      <strong>Limit historii:</strong> 1000 wpisÃ³w<br>
      <strong>Mechanizm:</strong> Automatyczne usuwanie najstarszych wpisÃ³w przy przekroczeniu limitu<br>
      <strong>Implementacja:</strong> CentralnyMagazynStanu.MAX_HISTORIA_SIZE = 1000
    </div>

    <!-- Statystyki -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-value" id="currentCount">0</div>
        <div class="stat-label">Aktualna liczba wpisÃ³w</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="maxLimit">1000</div>
        <div class="stat-label">Maksymalny limit</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="deletedCount">0</div>
        <div class="stat-label">UsuniÄ™tych wpisÃ³w</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="usagePercent">0%</div>
        <div class="stat-label">Wykorzystanie</div>
      </div>
    </div>

    <!-- Pasek postÄ™pu -->
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill">0%</div>
    </div>

    <!-- Kontrolki -->
    <div class="controls">
      <input type="number" id="addCount" value="10" min="1" max="10000" placeholder="Liczba wpisÃ³w">
      <button onclick="addMessages()" class="success">â• Dodaj Wpisy</button>
      <button onclick="addMessages(100)" class="warning">â• Dodaj 100</button>
      <button onclick="addMessages(500)" class="warning">â• Dodaj 500</button>
      <button onclick="addMessages(1500)" class="danger">â• Dodaj 1500 (Test limitu!)</button>
      <button onclick="testLimit()">ğŸ§ª Test Automatyczny</button>
      <button onclick="resetHistory()" class="danger">ğŸ—‘ï¸ WyczyÅ›Ä‡ HistoriÄ™</button>
      <button onclick="updateStats()">ğŸ”„ OdÅ›wieÅ¼</button>
    </div>

    <!-- Wyniki testÃ³w -->
    <div class="test-results" id="testResults">
      <h3>âœ… Wyniki Testu Automatycznego</h3>
      <div id="testResultsContent"></div>
    </div>

    <!-- Log -->
    <div class="log" id="log"></div>
  </div>

  <script src="CentralnyMagazynStanu.js"></script>
  <script>
    const magazyn = CentralnyMagazynStanu.getInstance();
    const log = document.getElementById('log');
    let totalDeleted = 0;

    function addLog(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString('pl-PL')}] ${message}`;
      log.insertBefore(entry, log.firstChild);
      console.log(message);
    }

    function updateStats() {
      const stan = magazyn.getStan();
      const currentCount = stan.historiaCzatu.length;
      const maxLimit = CentralnyMagazynStanu.MAX_HISTORIA_SIZE;
      const usagePercent = Math.round((currentCount / maxLimit) * 100);

      document.getElementById('currentCount').textContent = currentCount;
      document.getElementById('maxLimit').textContent = maxLimit;
      document.getElementById('deletedCount').textContent = totalDeleted;
      document.getElementById('usagePercent').textContent = usagePercent + '%';

      const progressFill = document.getElementById('progressFill');
      progressFill.style.width = usagePercent + '%';
      progressFill.textContent = usagePercent + '%';

      // ZmieÅ„ kolor paska w zaleÅ¼noÅ›ci od wykorzystania
      progressFill.className = 'progress-fill';
      if (usagePercent >= 90) {
        progressFill.classList.add('danger');
      } else if (usagePercent >= 70) {
        progressFill.classList.add('warning');
      }
    }

    function addMessages(count) {
      if (!count) {
        count = parseInt(document.getElementById('addCount').value) || 10;
      }

      const beforeCount = magazyn.getStan().historiaCzatu.length;
      addLog(`ğŸš€ Rozpoczynam dodawanie ${count} wpisÃ³w...`, 'info');

      for (let i = 1; i <= count; i++) {
        magazyn.dodajDoHistorii(`Test wpis #${beforeCount + i} - ${new Date().toISOString()}`);
      }

      const afterCount = magazyn.getStan().historiaCzatu.length;
      const deleted = (beforeCount + count) - afterCount;

      if (deleted > 0) {
        totalDeleted += deleted;
        addLog(`âš ï¸ Przekroczono limit! UsuniÄ™to ${deleted} najstarszych wpisÃ³w`, 'warning');
      }

      addLog(`âœ… Dodano ${count} wpisÃ³w. Aktualnie w historii: ${afterCount}`, 'success');
      updateStats();
    }

    function resetHistory() {
      if (confirm('Czy na pewno chcesz wyczyÅ›ciÄ‡ caÅ‚Ä… historiÄ™?')) {
        magazyn.resetujStan();
        totalDeleted = 0;
        addLog('ğŸ—‘ï¸ Historia wyczyszczona', 'info');
        updateStats();
      }
    }

    async function testLimit() {
      addLog('ğŸ§ª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
      addLog('ğŸ§ª ROZPOCZYNAM TEST AUTOMATYCZNY LIMITU HISTORII', 'info');
      addLog('ğŸ§ª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');

      const results = [];
      
      // Test 1: Dodaj 950 wpisÃ³w (poniÅ¼ej limitu)
      addLog('ğŸ“ Test 1: Dodawanie 950 wpisÃ³w (poniÅ¼ej limitu)...', 'info');
      magazyn.resetujStan();
      for (let i = 1; i <= 950; i++) {
        magazyn.dodajDoHistorii(`Test 1 wpis #${i}`);
      }
      const test1Count = magazyn.getStan().historiaCzatu.length;
      const test1Pass = test1Count === 950;
      results.push({ test: 'Test 1', expected: 950, actual: test1Count, pass: test1Pass });
      addLog(`${test1Pass ? 'âœ…' : 'âŒ'} Test 1: Oczekiwano 950, otrzymano ${test1Count}`, test1Pass ? 'success' : 'error');

      await sleep(500);

      // Test 2: Dodaj kolejne 100 wpisÃ³w (przekroczenie limitu o 50)
      addLog('ğŸ“ Test 2: Dodawanie 100 wpisÃ³w (przekroczenie o 50)...', 'info');
      for (let i = 1; i <= 100; i++) {
        magazyn.dodajDoHistorii(`Test 2 wpis #${i}`);
      }
      const test2Count = magazyn.getStan().historiaCzatu.length;
      const test2Pass = test2Count === 1000;
      results.push({ test: 'Test 2', expected: 1000, actual: test2Count, pass: test2Pass });
      addLog(`${test2Pass ? 'âœ…' : 'âŒ'} Test 2: Oczekiwano 1000 (limit), otrzymano ${test2Count}`, test2Pass ? 'success' : 'error');

      await sleep(500);

      // Test 3: Dodaj 500 wpisÃ³w (masowe przekroczenie)
      addLog('ğŸ“ Test 3: Dodawanie 500 wpisÃ³w (masowe przekroczenie)...', 'info');
      for (let i = 1; i <= 500; i++) {
        magazyn.dodajDoHistorii(`Test 3 wpis #${i}`);
      }
      const test3Count = magazyn.getStan().historiaCzatu.length;
      const test3Pass = test3Count === 1000;
      results.push({ test: 'Test 3', expected: 1000, actual: test3Count, pass: test3Pass });
      addLog(`${test3Pass ? 'âœ…' : 'âŒ'} Test 3: Oczekiwano 1000 (limit), otrzymano ${test3Count}`, test3Pass ? 'success' : 'error');

      await sleep(500);

      // Test 4: SprawdÅº, czy najnowsze wpisy sÄ… zachowane
      addLog('ğŸ“ Test 4: Weryfikacja kolejnoÅ›ci (najnowsze wpisy)...', 'info');
      const lastMessage = magazyn.getStan().historiaCzatu[magazyn.getStan().historiaCzatu.length - 1];
      const test4Pass = lastMessage.includes('Test 3 wpis #500');
      results.push({ test: 'Test 4', expected: 'Najnowszy wpis zachowany', actual: lastMessage, pass: test4Pass });
      addLog(`${test4Pass ? 'âœ…' : 'âŒ'} Test 4: ${test4Pass ? 'Najnowsze wpisy zachowane' : 'BÅ‚Ä…d kolejnoÅ›ci'}`, test4Pass ? 'success' : 'error');

      // Podsumowanie
      const allPass = results.every(r => r.pass);
      addLog('ğŸ§ª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
      addLog(`ğŸ§ª TEST ${allPass ? 'ZAKOÅƒCZONY SUKCESEM' : 'ZAKOÅƒCZONY Z BÅÄ˜DAMI'}`, allPass ? 'success' : 'error');
      addLog(`ğŸ§ª Zaliczono: ${results.filter(r => r.pass).length}/${results.length}`, 'info');
      addLog('ğŸ§ª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');

      // WyÅ›wietl wyniki
      const testResultsDiv = document.getElementById('testResults');
      const testResultsContent = document.getElementById('testResultsContent');
      testResultsContent.innerHTML = results.map(r => 
        `<div style="padding: 8px; margin: 4px 0; background: rgba(15, 23, 42, 0.6); border-radius: 4px; border-left: 3px solid ${r.pass ? '#10b981' : '#ef4444'}">
          <strong>${r.pass ? 'âœ…' : 'âŒ'} ${r.test}</strong><br>
          <small>Oczekiwano: ${r.expected}</small><br>
          <small>Otrzymano: ${typeof r.actual === 'string' && r.actual.length > 50 ? r.actual.substring(0, 50) + '...' : r.actual}</small>
        </div>`
      ).join('');
      testResultsDiv.classList.add('show');

      updateStats();
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Inicjalizacja
    window.addEventListener('load', () => {
      addLog('âœ… Test limitu historii zaÅ‚adowany', 'success');
      addLog(`â„¹ï¸ Maksymalny limit: ${CentralnyMagazynStanu.MAX_HISTORIA_SIZE} wpisÃ³w`, 'info');
      updateStats();
    });
  </script>
</body>
</html>
