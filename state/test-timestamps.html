<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Timestamp√≥w - Centralny Magazyn Stanu</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(30, 41, 59, 0.8);
      border: 1px solid rgba(51, 65, 85, 0.6);
      border-radius: 16px;
      padding: 40px;
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }
    h1 {
      font-size: 32px;
      margin-bottom: 24px;
      background: linear-gradient(135deg, #3b82f6, #06b6d4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .info-box {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid #3b82f6;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }
    .info-box strong {
      color: #3b82f6;
    }
    .controls {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      align-items: center;
    }
    input[type="text"] {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 6px;
      padding: 12px;
      color: #e2e8f0;
      font-size: 14px;
      flex: 1;
      min-width: 300px;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      font-size: 14px;
    }
    button:hover {
      background: #2563eb;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
    }
    button.success {
      background: #10b981;
    }
    button.success:hover {
      background: #059669;
    }
    button.warning {
      background: #eab308;
      color: #000;
    }
    button.warning:hover {
      background: #ca8a04;
    }
    button.danger {
      background: #ef4444;
    }
    button.danger:hover {
      background: #dc2626;
    }
    .messages-container {
      background: rgba(15, 23, 42, 0.8);
      border-radius: 8px;
      padding: 20px;
      margin-top: 24px;
      max-height: 500px;
      overflow-y: auto;
      border: 1px solid rgba(51, 65, 85, 0.6);
    }
    .message-card {
      background: rgba(30, 41, 59, 0.6);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      border-left: 3px solid #3b82f6;
      transition: all 0.2s;
    }
    .message-card:hover {
      background: rgba(30, 41, 59, 0.9);
      transform: translateX(5px);
    }
    .message-card:last-child {
      margin-bottom: 0;
    }
    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 12px;
    }
    .message-time {
      color: #94a3b8;
      font-family: 'Consolas', monospace;
    }
    .message-age {
      color: #6b7280;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.6);
      padding: 2px 8px;
      border-radius: 4px;
    }
    .message-text {
      color: #e2e8f0;
      font-size: 14px;
      line-height: 1.6;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: rgba(15, 23, 42, 0.8);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }
    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #3b82f6;
      margin-bottom: 8px;
    }
    .stat-label {
      font-size: 12px;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .test-results {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid #10b981;
      border-radius: 8px;
      padding: 20px;
      margin-top: 24px;
    }
    .test-results h3 {
      color: #10b981;
      margin-bottom: 12px;
    }
    .test-item {
      padding: 8px;
      margin: 4px 0;
      background: rgba(15, 23, 42, 0.6);
      border-radius: 4px;
      border-left: 3px solid #10b981;
    }
    .test-item.fail {
      border-left-color: #ef4444;
    }
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #6b7280;
    }
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üïê Test Timestamp√≥w</h1>
    
    <div class="info-box">
      <strong>Nowa struktura wiadomo≈õci:</strong> Ka≈ºda wiadomo≈õƒá jest zapisywana jako obiekt:<br>
      <code>{ tekst: "tre≈õƒá wiadomo≈õci", timestamp: "2025-11-02T12:34:56.789Z" }</code><br><br>
      <strong>Format timestamp:</strong> ISO 8601 (UTC) - pe≈Çna data i czas z milisekundami
    </div>

    <!-- Statystyki -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-value" id="totalMessages">0</div>
        <div class="stat-label">Wiadomo≈õci w historii</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="oldestTime">-</div>
        <div class="stat-label">Najstarsza wiadomo≈õƒá</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="newestTime">-</div>
        <div class="stat-label">Najnowsza wiadomo≈õƒá</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="timeSpan">-</div>
        <div class="stat-label">Zakres czasu</div>
      </div>
    </div>

    <!-- Kontrolki -->
    <div class="controls">
      <input type="text" id="messageInput" placeholder="Wpisz wiadomo≈õƒá..." />
      <button onclick="addMessage()" class="success">‚ûï Dodaj</button>
      <button onclick="addTestMessages()">üìù Dodaj Testowe (10)</button>
      <button onclick="runTests()" class="warning">üß™ Uruchom Testy</button>
      <button onclick="clearHistory()" class="danger">üóëÔ∏è Wyczy≈õƒá</button>
      <button onclick="refreshDisplay()">üîÑ Od≈õwie≈º</button>
    </div>

    <!-- Wyniki test√≥w -->
    <div class="test-results" id="testResults" style="display: none;">
      <h3>‚úÖ Wyniki Test√≥w Automatycznych</h3>
      <div id="testResultsContent"></div>
    </div>

    <!-- Lista wiadomo≈õci -->
    <div class="messages-container" id="messagesContainer">
      <div class="empty-state">
        <div class="empty-state-icon">üì≠</div>
        <div>Brak wiadomo≈õci w historii</div>
        <div style="font-size: 12px; margin-top: 8px;">Dodaj pierwszƒÖ wiadomo≈õƒá aby zobaczyƒá timestampy</div>
      </div>
    </div>
  </div>

  <script src="CentralnyMagazynStanu.js"></script>
  <script>
    const magazyn = CentralnyMagazynStanu.getInstance();

    // Pomocnicza funkcja do formatowania czasu
    function formatTimestamp(isoString) {
      const date = new Date(isoString);
      return date.toLocaleString('pl-PL', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        fractionalSecondDigits: 3
      });
    }

    // Pomocnicza funkcja do obliczania wieku wiadomo≈õci
    function getMessageAge(timestamp) {
      const now = new Date();
      const then = new Date(timestamp);
      const diffMs = now - then;
      const diffSec = Math.floor(diffMs / 1000);
      const diffMin = Math.floor(diffSec / 60);
      const diffHour = Math.floor(diffMin / 60);

      if (diffSec < 60) return `${diffSec}s temu`;
      if (diffMin < 60) return `${diffMin}m temu`;
      if (diffHour < 24) return `${diffHour}h temu`;
      return `${Math.floor(diffHour / 24)}d temu`;
    }

    // Dodaj wiadomo≈õƒá
    function addMessage() {
      const input = document.getElementById('messageInput');
      const text = input.value.trim();
      
      if (!text) {
        alert('Wpisz tre≈õƒá wiadomo≈õci!');
        return;
      }

      const msg = magazyn.dodajDoHistorii(text);
      console.log('Dodano wiadomo≈õƒá:', msg);
      
      input.value = '';
      refreshDisplay();
    }

    // Dodaj testowe wiadomo≈õci
    function addTestMessages() {
      const testMessages = [
        'Test wiadomo≈õci #1',
        'Sprawdzam dzia≈Çanie timestamp√≥w',
        'To jest kolejna wiadomo≈õƒá testowa',
        'Ka≈ºda ma sw√≥j unikalny timestamp',
        'Format ISO 8601 zapewnia jednoznaczno≈õƒá',
        'Milisekundy pozwalajƒÖ na precyzjƒô',
        'UTC eliminuje problemy ze strefami czasowymi',
        'Historia zachowuje chronologiƒô',
        'Mo≈ºna ≈Çatwo sortowaƒá po czasie',
        'Test zako≈Ñczony pomy≈õlnie! ‚úÖ'
      ];

      testMessages.forEach((msg, index) => {
        setTimeout(() => {
          magazyn.dodajDoHistorii(msg);
          if (index === testMessages.length - 1) {
            refreshDisplay();
          }
        }, index * 100); // Odstƒôp 100ms miƒôdzy wiadomo≈õciami
      });
    }

    // Wyczy≈õƒá historiƒô
    function clearHistory() {
      if (confirm('Czy na pewno chcesz wyczy≈õciƒá ca≈ÇƒÖ historiƒô?')) {
        magazyn.resetujStan();
        refreshDisplay();
      }
    }

    // Od≈õwie≈º wy≈õwietlanie
    function refreshDisplay() {
      const stan = magazyn.getStan();
      const historia = stan.historiaCzatu;
      
      // Aktualizuj statystyki
      document.getElementById('totalMessages').textContent = historia.length;
      
      if (historia.length > 0) {
        const oldest = new Date(historia[0].timestamp);
        const newest = new Date(historia[historia.length - 1].timestamp);
        const spanMs = newest - oldest;
        const spanSec = Math.floor(spanMs / 1000);
        
        document.getElementById('oldestTime').textContent = formatTimestamp(historia[0].timestamp);
        document.getElementById('newestTime').textContent = formatTimestamp(historia[historia.length - 1].timestamp);
        document.getElementById('timeSpan').textContent = spanSec > 0 ? `${spanSec}s` : '0s';
      } else {
        document.getElementById('oldestTime').textContent = '-';
        document.getElementById('newestTime').textContent = '-';
        document.getElementById('timeSpan').textContent = '-';
      }
      
      // Wy≈õwietl wiadomo≈õci
      const container = document.getElementById('messagesContainer');
      
      if (historia.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üì≠</div>
            <div>Brak wiadomo≈õci w historii</div>
            <div style="font-size: 12px; margin-top: 8px;">Dodaj pierwszƒÖ wiadomo≈õƒá aby zobaczyƒá timestampy</div>
          </div>
        `;
        return;
      }
      
      // Poka≈º wiadomo≈õci od najnowszej do najstarszej
      container.innerHTML = historia.slice().reverse().map((msg, index) => `
        <div class="message-card">
          <div class="message-header">
            <span class="message-time">üïê ${formatTimestamp(msg.timestamp)}</span>
            <span class="message-age">${getMessageAge(msg.timestamp)}</span>
          </div>
          <div class="message-text">${msg.tekst}</div>
        </div>
      `).join('');
    }

    // Uruchom testy
    async function runTests() {
      const testResults = [];
      console.log('üß™ Rozpoczynam testy timestamp√≥w...');
      
      // Test 1: Struktura obiektu
      magazyn.resetujStan();
      const msg1 = magazyn.dodajDoHistorii('Test 1');
      const test1Pass = msg1 && typeof msg1 === 'object' && 'tekst' in msg1 && 'timestamp' in msg1;
      testResults.push({
        name: 'Test 1: Struktura obiektu',
        pass: test1Pass,
        details: test1Pass ? 'Obiekt ma pola: tekst, timestamp' : 'B≈Çƒôdna struktura obiektu'
      });
      
      // Test 2: Format timestamp (ISO 8601)
      const isoRegex = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/;
      const test2Pass = isoRegex.test(msg1.timestamp);
      testResults.push({
        name: 'Test 2: Format ISO 8601',
        pass: test2Pass,
        details: test2Pass ? `Timestamp: ${msg1.timestamp}` : 'Nieprawid≈Çowy format timestamp'
      });
      
      // Test 3: Chronologia timestamp√≥w
      await sleep(10);
      const msg2 = magazyn.dodajDoHistorii('Test 2');
      await sleep(10);
      const msg3 = magazyn.dodajDoHistorii('Test 3');
      
      const time1 = new Date(msg1.timestamp).getTime();
      const time2 = new Date(msg2.timestamp).getTime();
      const time3 = new Date(msg3.timestamp).getTime();
      const test3Pass = time1 < time2 && time2 < time3;
      testResults.push({
        name: 'Test 3: Chronologia timestamp√≥w',
        pass: test3Pass,
        details: test3Pass ? 'Timestampy rosnƒÖ monotonnie' : 'B≈ÇƒÖd w kolejno≈õci timestamp√≥w'
      });
      
      // Test 4: Timestamp jest aktualny (w ciƒÖgu ostatnich 5 sekund)
      const now = Date.now();
      const msgTime = new Date(msg3.timestamp).getTime();
      const test4Pass = (now - msgTime) < 5000;
      testResults.push({
        name: 'Test 4: Aktualno≈õƒá timestamp',
        pass: test4Pass,
        details: test4Pass ? 'Timestamp odpowiada bie≈ºƒÖcemu czasowi' : 'Timestamp nie jest aktualny'
      });
      
      // Test 5: Parsowanie timestamp
      let test5Pass = false;
      try {
        const parsed = new Date(msg1.timestamp);
        test5Pass = !isNaN(parsed.getTime());
      } catch (e) {
        test5Pass = false;
      }
      testResults.push({
        name: 'Test 5: Parsowanie timestamp',
        pass: test5Pass,
        details: test5Pass ? 'Timestamp mo≈ºna poprawnie sparsowaƒá' : 'B≈ÇƒÖd parsowania timestamp'
      });
      
      // Wy≈õwietl wyniki
      const allPass = testResults.every(r => r.pass);
      const resultsDiv = document.getElementById('testResults');
      const contentDiv = document.getElementById('testResultsContent');
      
      contentDiv.innerHTML = testResults.map(r => `
        <div class="test-item ${r.pass ? '' : 'fail'}">
          <strong>${r.pass ? '‚úÖ' : '‚ùå'} ${r.name}</strong><br>
          <small>${r.details}</small>
        </div>
      `).join('');
      
      resultsDiv.style.display = 'block';
      
      console.log(allPass ? '‚úÖ Wszystkie testy zaliczone!' : '‚ùå Niekt√≥re testy nie przesz≈Çy');
      refreshDisplay();
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Obs≈Çuga Enter w polu tekstowym
    document.getElementById('messageInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        addMessage();
      }
    });

    // Inicjalizacja
    window.addEventListener('load', () => {
      refreshDisplay();
      console.log('‚úÖ Test timestamp√≥w za≈Çadowany');
    });

    // Auto-refresh wieku wiadomo≈õci co 1 sekundƒô
    setInterval(() => {
      const cards = document.querySelectorAll('.message-card');
      if (cards.length > 0) {
        const stan = magazyn.getStan();
        const historia = stan.historiaCzatu;
        
        cards.forEach((card, index) => {
          const msg = historia[historia.length - 1 - index]; // Odwr√≥cona kolejno≈õƒá
          const ageSpan = card.querySelector('.message-age');
          if (ageSpan && msg) {
            ageSpan.textContent = getMessageAge(msg.timestamp);
          }
        });
      }
    }, 1000);
  </script>
</body>
</html>
