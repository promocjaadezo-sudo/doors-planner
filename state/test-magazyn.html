<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test - Centralny Magazyn Stanu</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    .card {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 8px;
      margin-bottom: 8px;
    }
    button:hover {
      background: #2563eb;
    }
    button.red {
      background: #ef4444;
    }
    button.red:hover {
      background: #dc2626;
    }
    button.green {
      background: #10b981;
    }
    button.green:hover {
      background: #059669;
    }
    #konsola {
      background: #000;
      color: #0f0;
      font-family: 'Courier New', monospace;
      padding: 15px;
      border-radius: 6px;
      height: 300px;
      overflow-y: auto;
      font-size: 12px;
      line-height: 1.5;
    }
    pre {
      background: #0b1222;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª Test - Centralny Magazyn Stanu</h1>
  
  <div class="card">
    <h2>Akcje testowe</h2>
    <button onclick="testGetInstance()">ğŸ” Pobierz instancjÄ™</button>
    <button onclick="testGetStan()">ğŸ“Š PokaÅ¼ stan</button>
    <button onclick="testDodajWiadomosc()">ğŸ’¬ Dodaj wiadomoÅ›Ä‡</button>
    <button onclick="testUstawSesje()">ğŸ”— Ustaw sesjÄ™</button>
    <button onclick="testUstawStatus('processing')">â–¶ï¸ Status: Processing</button>
    <button onclick="testUstawStatus('error', 'Testowy bÅ‚Ä…d')">âŒ Status: Error</button>
    <button onclick="testUstawStatus('idle')">â¸ï¸ Status: Idle</button>
    <button onclick="testEksportJSON()" class="green">ğŸ“¤ Eksport JSON</button>
    <button onclick="testResetuj()" class="red">ğŸ”„ Resetuj stan</button>
  </div>
  
  <div class="card">
    <h2>Aktualny stan</h2>
    <pre id="stan-display">Kliknij "PokaÅ¼ stan" aby zobaczyÄ‡...</pre>
  </div>
  
  <div class="card">
    <h2>Konsola</h2>
    <div id="konsola"></div>
  </div>

  <script src="CentralnyMagazynStanu.js"></script>
  <script>
    // PrzechwyÄ‡ console.log do naszej konsoli
    const originalLog = console.log;
    const konsolaDiv = document.getElementById('konsola');
    
    console.log = function(...args) {
      originalLog.apply(console, args);
      const message = args.map(arg => 
        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
      ).join(' ');
      konsolaDiv.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
      konsolaDiv.scrollTop = konsolaDiv.scrollHeight;
    };

    console.log('=== Test Centralnego Magazynu Stanu ===');
    
    let magazyn;
    let licznikWiadomosci = 0;
    
    function testGetInstance() {
      magazyn = CentralnyMagazynStanu.getInstance();
      console.log('Instancja pobrana:', magazyn);
      
      // Test czy to singleton
      const magazyn2 = CentralnyMagazynStanu.getInstance();
      if (magazyn === magazyn2) {
        console.log('âœ… Singleton dziaÅ‚a poprawnie - obie instancje sÄ… identyczne');
      } else {
        console.log('âŒ BÅÄ„D: Singleton nie dziaÅ‚a - instancje sÄ… rÃ³Å¼ne!');
      }
    }
    
    function testGetStan() {
      if (!magazyn) testGetInstance();
      const stan = magazyn.getStan();
      console.log('Aktualny stan aplikacji:', stan);
      document.getElementById('stan-display').textContent = JSON.stringify(stan, null, 2);
    }
    
    function testDodajWiadomosc() {
      if (!magazyn) testGetInstance();
      licznikWiadomosci++;
      const wiadomosc = `Testowa wiadomoÅ›Ä‡ #${licznikWiadomosci} (${new Date().toLocaleTimeString()})`;
      magazyn.dodajDoHistorii(wiadomosc);
      console.log(`Dodano: "${wiadomosc}"`);
      testGetStan();
    }
    
    function testUstawSesje() {
      if (!magazyn) testGetInstance();
      const sesjaId = 'sesja-' + Math.random().toString(36).substr(2, 9);
      magazyn.ustawSesje(sesjaId);
      testGetStan();
    }
    
    function testUstawStatus(status, blad) {
      if (!magazyn) testGetInstance();
      magazyn.ustawStatus(status, blad);
      testGetStan();
    }
    
    function testResetuj() {
      if (!magazyn) testGetInstance();
      if (confirm('Czy na pewno chcesz zresetowaÄ‡ stan?')) {
        magazyn.resetujStan();
        licznikWiadomosci = 0;
        testGetStan();
      }
    }
    
    function testEksportJSON() {
      if (!magazyn) testGetInstance();
      const json = magazyn.exportujDoJSON();
      console.log('Wyeksportowany JSON:');
      console.log(json);
      
      // Skopiuj do schowka
      navigator.clipboard.writeText(json).then(() => {
        alert('âœ… JSON skopiowany do schowka!');
      }).catch(err => {
        console.error('BÅ‚Ä…d kopiowania:', err);
      });
    }
    
    // Automatyczny test przy starcie
    console.log('ğŸš€ Uruchamiam automatyczny test...');
    testGetInstance();
    testGetStan();
    console.log('âœ… Test zakoÅ„czony - moÅ¼esz teraz testowaÄ‡ rÄ™cznie');
  </script>
</body>
</html>
